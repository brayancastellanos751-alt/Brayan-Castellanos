<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Esmeraldas del Saber Financiero — Coscuez, Boyacá</title>
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
<style>
  :root{
    --bg:#04100f;
    --card:#0f1716;
    --emerald:#006a44;
    --emerald-bright:#00c06b;
    --gold:#c9a75a;
    --muted:#bfc7c4;
    --glass: rgba(255,255,255,0.03);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: "Inter", "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: linear-gradient(180deg,var(--bg), #03100f 140%);
    color: #e8efec;
    -webkit-font-smoothing:antialiased;
    line-height:1.6;
    scroll-behavior:smooth;
  }

  header{
    background: linear-gradient(135deg, rgba(0,106,68,0.95), rgba(8,80,52,0.95));
    padding:36px 18px;
    text-align:center;
    box-shadow: 0 8px 28px rgba(0,0,0,0.45);
    position:sticky; top:0; z-index:60;
  }
  .logo{ width:64px; height:64px; border-radius:14px; background:linear-gradient(180deg,var(--emerald),var(--emerald-bright)); display:inline-flex; align-items:center; justify-content:center; color:#04130e; font-weight:900; margin-right:12px; font-size:18px; box-shadow:0 6px 18px rgba(0,0,0,0.4) }
  header h1{ margin:10px 0 2px; color:var(--gold); font-size:clamp(1.6rem,2.6vw,2.4rem) }
  header p{ margin:0; color:var(--muted); font-size:0.98rem }

  nav{ display:flex; gap:10px; justify-content:center; padding:10px; background:rgba(0,0,0,0.12); position:sticky; top:110px; z-index:50; flex-wrap:wrap }
  nav a{ color:var(--muted); text-decoration:none; padding:8px 12px; border-radius:8px; font-weight:700; transition:all .22s; font-size:0.95rem }
  nav a:hover{ color:var(--emerald-bright); transform:translateY(-3px) }

  main{ max-width:1100px; margin:28px auto; padding:0 18px 70px }
  section.card{
    background: linear-gradient(180deg,var(--card), rgba(255,255,255,0.01));
    border-radius:14px; padding:26px; margin-bottom:26px;
    box-shadow: 0 12px 34px rgba(0,0,0,0.45);
    border:1px solid rgba(255,255,255,0.03);
    opacity:0; transform:translateY(18px); transition:all .6s cubic-bezier(.2,.9,.2,1);
  }
  section.card.visible{ opacity:1; transform:none }

  .lead{ display:flex; gap:16px; align-items:center; flex-wrap:wrap }
  /* placeholder thumb (no images) */
  .thumb{ width:160px; min-width:120px; border-radius:10px; overflow:hidden; box-shadow:0 10px 30px rgba(0,0,0,0.6); border:1px solid rgba(255,255,255,0.03); display:flex; align-items:center; justify-content:center; background:linear-gradient(180deg, rgba(0,106,68,0.9), rgba(0,192,107,0.2)); color:#04130e; font-weight:800; font-size:14px }
  .text{ flex:1; min-width:220px }

  h2{ margin-top:0; color:var(--emerald-bright); font-size:1.25rem }
  p{ color:var(--muted); margin:0 0 12px 0 }

  /* Accordion */
  .accordion{ margin-top:8px; display:grid; gap:12px }
  .acc-item{ background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00)); border-radius:10px; overflow:hidden; border:1px solid rgba(255,255,255,0.03) }
  .acc-head{ display:flex; align-items:center; gap:12px; padding:14px 16px; cursor:pointer }
  .acc-head h3{ margin:0; font-size:1rem; color:var(--gold) }
  .acc-head small{ color:var(--muted); margin-left:6px; font-weight:600 }
  .acc-icon{ margin-left:auto; width:34px;height:34px;border-radius:8px; display:grid;place-items:center;background:var(--glass); transition:transform .28s }
  .acc-body{ max-height:0; padding:0 16px; overflow:hidden; transition:max-height .42s, padding .32s; border-top:1px dashed rgba(255,255,255,0.03) }
  .acc-body.open{ padding:16px; max-height:520px }

  .gloss-example{ background: rgba(255,255,255,0.02); padding:12px; border-radius:8px; color:var(--muted); font-size:0.97rem }

  /* Books */
  .books-grid{ display:grid; grid-template-columns:repeat(auto-fill,minmax(240px,1fr)); gap:14px; margin-top:12px }
  .book{
    background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
    padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,0.03);
    transition:transform .28s, box-shadow .28s;
    display:flex; flex-direction:column;
  }
  .book:hover{ transform:translateY(-6px); box-shadow:0 14px 36px rgba(0,0,0,0.6) }
  .book .cover{ height:140px; border-radius:8px; overflow:hidden; margin-bottom:10px; display:flex; align-items:center; justify-content:center; font-weight:800; color:#04130e; background:linear-gradient(180deg,var(--emerald),var(--emerald-bright)); font-size:0.95rem; text-align:center; padding:8px }
  .book h4{ margin:6px 0 6px; color:var(--emerald-bright) }
  .book p{ color:var(--muted); font-size:0.95rem; margin:0 0 10px 0; flex:1 }

  .download-row{ display:flex; gap:8px; align-items:center; margin-top:8px }

  /* Quiz original (improved) */
  .quiz-container{ background:linear-gradient(180deg, rgba(0,0,0,0.35), rgba(0,0,0,0.45)); border-radius:12px; padding:18px; border:1px solid rgba(0,200,107,0.06) }
  .q-block{ margin-bottom:12px; padding:12px; border-radius:8px; background:rgba(255,255,255,0.01) }
  .q-block.correct{ border:1px solid rgba(0,200,107,0.18); box-shadow:0 8px 20px rgba(0,200,107,0.04) }
  .q-block.wrong{ border:1px solid rgba(255,80,80,0.12) }
  .q-block .question{ color:var(--emerald-bright); font-weight:700 }
  .options label{ display:block; margin:8px 0; cursor:pointer; padding:8px 10px; border-radius:8px; transition:background .16s; color:var(--muted) }
  .options label:hover{ background:rgba(0,200,107,0.03) }

  .btn{ background:linear-gradient(180deg,var(--emerald),var(--emerald-bright)); color:#04130e; padding:10px 14px; border-radius:10px; border:none; cursor:pointer; font-weight:700; box-shadow:0 10px 24px rgba(0,200,107,0.08) }
  .btn.ghost{ background:transparent; color:var(--muted); border:1px solid rgba(255,255,255,0.03) }

  #result{ margin-top:14px; padding:12px; border-radius:10px; background:rgba(0,0,0,0.35); color:var(--emerald-bright); font-weight:700; text-align:center; border:1px solid rgba(0,200,107,0.06) }

  /* Crossword */
  .crossword-wrap{ display:flex; gap:18px; flex-wrap:wrap; align-items:flex-start }
  .cw-grid{ display:grid; gap:3px; background:transparent; padding:6px; border-radius:8px }
  .cw-cell{ width:36px; height:36px; display:flex; align-items:center; justify-content:center; background:rgba(255,255,255,0.02); border-radius:6px; border:1px solid rgba(255,255,255,0.03) }
  .cw-cell.black{ background:#04100f; border:1px solid rgba(0,0,0,0.6) }
  .cw-cell input{ width:100%; height:100%; border:0; background:transparent; color:var(--muted); font-weight:700; text-align:center; font-size:1rem; outline:none }
  .clues{ min-width:260px; max-width:420px }
  .clues h4{ margin:6px 0; color:var(--emerald-bright) }
  .clues ol{ color:var(--muted) }
  .cw-actions{ margin-top:8px; display:flex; gap:8px; flex-wrap:wrap }

  footer{ margin-top:28px; padding:22px 18px; text-align:center; color:var(--muted); border-top:1px solid rgba(255,255,255,0.02) }

  @media (max-width:880px){ .lead{ flex-direction:column; align-items:flex-start } .thumb{ width:100%; min-width:unset } .cw-grid{ order:2 } .clues{ order:1 } }
</style>
</head>
<body>

<header>
  <div style="display:flex; align-items:center; justify-content:center">
    <div class="logo">ES</div>
  </div>
  <h1>Esmeraldas del Saber Financiero</h1>
  <p>Proyecto — Coscuez (San Pablo de Borbur), Boyacá · Educación Financiera contextualizada para jóvenes</p>
</header>

<nav>
  <a href="#contexto">Contexto</a>
  <a href="#conceptos">Conceptos</a>
  <a href="#libros">Libros</a>
  <a href="#quiz">Quiz</a>
  <a href="#crucigrama">Crucigrama</a>
  <a href="#recomendaciones">Recomendaciones</a>
</nav>

<main>
  <!-- CONTEXTO -->
  <section id="contexto" class="card">
    <div class="lead">
      <div class="thumb" aria-hidden="true">
        <div style="text-align:center;padding:8px;">
          <div style="font-size:20px">Coscuez</div>
          <div style="font-size:12px;margin-top:6px;color:#04130e">Boyacá</div>
        </div>
      </div>
      <div class="text">
        <h2>Contexto — Coscuez</h2>
        <p>
          Coscuez es una vereda con tradición esmeraldífera dentro del municipio de San Pablo de Borbur. La extracción de esmeraldas genera ingresos valiosos pero irregulares: hay periodos de alta liquidez seguidos de lapsos de poca o ninguna entrada de dinero.
        </p>
        <p>
          Ese vaivén exige habilidades distintas: planificar, priorizar y aprender a guardar parte de lo que entra para el futuro. Este proyecto apunta a formar en esas habilidades a estudiantes de grado 9° para que puedan transformar oportunidades temporales en bienestar durable.
        </p>
      </div>
    </div>
  </section>

  <!-- CONCEPTOS -->
  <section id="conceptos" class="card">
    <h2>Conceptos clave (haz clic para desplegar)</h2>
    <div class="accordion" id="accordion">
      <!-- (items as original) -->
      <article class="acc-item">
        <div class="acc-head" data-target="acc1" role="button" aria-expanded="false">
          <div><h3>Presupuesto</h3><small>Planifica ingresos y gastos</small></div>
          <div class="acc-icon"><svg width="18" height="18" viewBox="0 0 24 24"><path d="M12 16l-6-6h12z"/></svg></div>
        </div>
        <div id="acc1" class="acc-body" aria-hidden="true">
          <p class="gloss-example"><strong>Definición:</strong> Un presupuesto compara ingresos y gastos en un período. En Coscuez, al trabajar por producción, conviene estimar ingresos promedio conservadores y priorizar gastos esenciales.</p>
          <p><strong>Guía práctica:</strong> Anota durante 3 meses los ingresos reales, saca un promedio prudente y arma un presupuesto que cubra necesidades, ahorre y permita invertir pequeñas porciones en proyectos o educación.</p>
        </div>
      </article>

      <article class="acc-item">
        <div class="acc-head" data-target="acc2" role="button" aria-expanded="false">
          <div><h3>Ahorro</h3><small>Reserva para imprevistos y metas</small></div>
          <div class="acc-icon"><svg width="18" height="18" viewBox="0 0 24 24"><path d="M12 16l-6-6h12z"/></svg></div>
        </div>
        <div id="acc2" class="acc-body" aria-hidden="true">
          <p class="gloss-example"><strong>Definición:</strong> Porción del ingreso destinada a seguridad financiera o metas.</p>
          <p><strong>Consejo para Coscuez:</strong> Si recibes dinero por la venta de esmeraldas, aparta inmediatamente 10–20% para ahorro. Con el tiempo, ese hábito construye un fondo capaz de cubrir emergencias o financiar proyectos productivos.</p>
        </div>
      </article>

      <article class="acc-item">
        <div class="acc-head" data-target="acc3" role="button" aria-expanded="false">
          <div><h3>Inversión</h3><small>Hacer crecer el dinero</small></div>
          <div class="acc-icon"><svg width="18" height="18" viewBox="0 0 24 24"><path d="M12 16l-6-6h12z"/></svg></div>
        </div>
        <div id="acc3" class="acc-body" aria-hidden="true">
          <p class="gloss-example"><strong>Definición:</strong> Usar recursos para generar beneficios en el tiempo.</p>
          <p><strong>Ideas prácticas:</strong> Pequeñas inversiones en emprendimientos locales, compra de herramientas que aumenten productividad o cursos que mejoren habilidades técnicas pueden generar retornos sostenibles para la familia minera.</p>
        </div>
      </article>

      <article class="acc-item">
        <div class="acc-head" data-target="acc4" role="button" aria-expanded="false">
          <div><h3>Crédito</h3><small>Préstamos con condiciones</small></div>
          <div class="acc-icon"><svg width="18" height="18" viewBox="0 0 24 24"><path d="M12 16l-6-6h12z"/></svg></div>
        </div>
        <div id="acc4" class="acc-body" aria-hidden="true">
          <p class="gloss-example"><strong>Definición:</strong> Dinero prestado que se devuelve con intereses.</p>
          <p><strong>Recomendación:</strong> Evitar prestamistas informales. Si se toma crédito, calcular capacidad de pago real y preferir condiciones claras; el crédito debe ser una herramienta para crecer, no para sostener gastos corrientes.</p>
        </div>
      </article>

      <article class="acc-item">
        <div class="acc-head" data-target="acc5" role="button" aria-expanded="false">
          <div><h3>Fondo de emergencia</h3><small>Colchón ante imprevistos</small></div>
          <div class="acc-icon"><svg width="18" height="18" viewBox="0 0 24 24"><path d="M12 16l-6-6h12z"/></svg></div>
        </div>
        <div id="acc5" class="acc-body" aria-hidden="true">
          <p class="gloss-example"><strong>Definición:</strong> Reserva líquida para gastos inesperados (accidentes, enfermedad, paros).</p>
          <p><strong>Consejo:</strong> Mantenerlo en un lugar seguro y accesible, separado de dinero destinado a gastos cotidianos; objetivo mínimo: 3 meses de gastos esenciales.</p>
        </div>
      </article>

      <article class="acc-item">
        <div class="acc-head" data-target="acc6" role="button" aria-expanded="false">
          <div><h3>Consumo responsable</h3><small>Priorizar necesidades</small></div>
          <div class="acc-icon"><svg width="18" height="18" viewBox="0 0 24 24"><path d="M12 16l-6-6h12z"/></svg></div>
        </div>
        <div id="acc6" class="acc-body" aria-hidden="true">
          <p class="gloss-example"><strong>Definición:</strong> Tomar decisiones de compra según prioridades reales.</p>
          <p><strong>Práctica:</strong> Antes de comprar, pregunta: ¿esto es esencial? Si la respuesta es no y el dinero es limitado, posponer la compra protege el presupuesto familiar.</p>
        </div>
      </article>

      <article class="acc-item">
        <div class="acc-head" data-target="acc7" role="button" aria-expanded="false">
          <div><h3>Puntaje crediticio</h3><small>Historial y confianza</small></div>
          <div class="acc-icon"><svg width="18" height="18" viewBox="0 0 24 24"><path d="M12 16l-6-6h12z"/></svg></div>
        </div>
        <div id="acc7" class="acc-body" aria-hidden="true">
          <p class="gloss-example"><strong>Definición:</strong> Medida usada por entidades para evaluar la probabilidad de repago.</p>
          <p><strong>Consejo:</strong> Pagar obligaciones a tiempo y evitar moras; lleva un control simple de pagos para construir historial y acceder a mejores oportunidades si se necesita crédito.</p>
        </div>
      </article>

      <article class="acc-item">
        <div class="acc-head" data-target="acc8" role="button" aria-expanded="false">
          <div><h3>Diversificación</h3><small>Reducir riesgos</small></div>
          <div class="acc-icon"><svg width="18" height="18" viewBox="0 0 24 24"><path d="M12 16l-6-6h12z"/></svg></div>
        </div>
        <div id="acc8" class="acc-body" aria-hidden="true">
          <p class="gloss-example"><strong>Definición:</strong> Dispersar recursos en varias actividades para no depender de una sola fuente.</p>
          <p><strong>Ejemplo:</strong> Combinar ingresos mineros con agricultura, comercio o servicios; así la familia resiste mejor ante caídas en la producción o precio del mineral.</p>
        </div>
      </article>
    </div>
  </section>

  <!-- BOOKS -->
  <section id="libros" class="card">
    <h2>Libros recomendados — Lecturas que transforman</h2>
    <p style="margin-bottom:8px">Aquí tienes una selección que mezcla educación financiera pura y herramientas de mentalidad y productividad. Los textos incluyen resúmenes y botones para descargar una guía breve (archivo generado localmente) para cada título.</p>

    <div class="books-grid">
      <!-- Book 1 -->
      <article class="book">
        <div class="cover">Padre Rico — Portada (sin imagen)</div>
        <h4>Padre Rico, Padre Pobre — Robert Kiyosaki</h4>
        <p>
          Kiyosaki desafía la idea de que estudiar mucho garantiza seguridad financiera. Este libro diferencia activos y pasivos y enseña a crear flujos de ingreso.
        </p>
        <div class="download-row">
          <button class="btn download-btn" data-title="Padre Rico, Padre Pobre" data-author="Robert Kiyosaki">Descargar guía</button>
          <button class="btn ghost" data-preview="Padre Rico, Padre Pobre">Ver resumen</button>
        </div>
      </article>

      <!-- Book 2 -->
      <article class="book">
        <div class="cover">Babilonia — Portada (sin imagen)</div>
        <h4>El hombre más rico de Babilonia — George S. Clason</h4>
        <p>
          Parabolas con lecciones básicas: paga a ti mismo primero, controla los gastos y haz que tu dinero trabaje para ti.
        </p>
        <div class="download-row">
          <button class="btn download-btn" data-title="El hombre más rico de Babilonia" data-author="George S. Clason">Descargar guía</button>
          <button class="btn ghost" data-preview="El hombre más rico de Babilonia">Ver resumen</button>
        </div>
      </article>

      <!-- Book 3 -->
      <article class="book">
        <div class="cover">Mente Millonaria — Portada (sin imagen)</div>
        <h4>Los secretos de la mente millonaria — T. Harv Eker</h4>
        <p>
          Explora creencias que limitan la prosperidad y combina actitud mental con acciones concretas para planificar e invertir.
        </p>
        <div class="download-row">
          <button class="btn download-btn" data-title="Los secretos de la mente millonaria" data-author="T. Harv Eker">Descargar guía</button>
          <button class="btn ghost" data-preview="Los secretos de la mente millonaria">Ver resumen</button>
        </div>
      </article>

      <!-- Book 4 -->
      <article class="book">
        <div class="cover">Piense y Hágase Rico — Portada (sin imagen)</div>
        <h4>Piense y hágase rico — Napoleon Hill</h4>
        <p>
          Un clásico sobre mentalidad, metas y perseverancia; útil para jóvenes líderes que quieran transformar ideas en proyectos.
        </p>
        <div class="download-row">
          <button class="btn download-btn" data-title="Piense y hágase rico" data-author="Napoleon Hill">Descargar guía</button>
          <button class="btn ghost" data-preview="Piense y hágase rico">Ver resumen</button>
        </div>
      </article>

      <!-- Book 5 -->
      <article class="book">
        <div class="cover">Hábitos Atómicos — Portada (sin imagen)</div>
        <h4>Hábitos atómicos — James Clear</h4>
        <p>
          Cómo pequeños cambios diarios generan resultados enormes con el tiempo. Ideal para construir disciplina financiera.
        </p>
        <div class="download-row">
          <button class="btn download-btn" data-title="Hábitos atómicos" data-author="James Clear">Descargar guía</button>
          <button class="btn ghost" data-preview="Hábitos atómicos">Ver resumen</button>
        </div>
      </article>

      <!-- Book 6 -->
      <article class="book">
        <div class="cover">Guía práctica — Portada (sin imagen)</div>
        <h4>Guía práctica a la inversión (selección breve)</h4>
        <p>
          Lecturas y guías básicas sobre inversión responsable: entender riesgo, horizonte temporal y diversificación.
        </p>
        <div class="download-row">
          <button class="btn download-btn" data-title="Guía práctica a la inversión" data-author="Equipo Didáctico">Descargar guía</button>
          <button class="btn ghost" data-preview="Guía práctica a la inversión">Ver resumen</button>
        </div>
      </article>
    </div>
  </section>

  <!-- QUIZ (improved & random options) -->
  <section id="quiz" class="card">
    <h2>Quiz — Repasa lo aprendido</h2>
    <p>Responde y luego presiona <strong>Calcular resultado</strong>. Las opciones se mostrarán en orden aleatorio cada vez.</p>

    <div class="quiz-container" id="quizContainer"></div>

    <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
      <button id="checkBtn" class="btn">Calcular resultado</button>
      <button id="resetBtn" class="btn ghost">Reiniciar</button>
    </div>

    <div id="result" role="status" aria-atomic="true" style="display:none"></div>
  </section>

  <!-- CRUCIGRAMA -->
  <section id="crucigrama" class="card">
    <h2>Crucigrama financiero — Pon a prueba tu vocabulario</h2>
    <p>Completa las casillas con las palabras relacionadas. Usa mayúsculas o minúsculas; cuando termines, presiona <strong>Comprobar</strong>. Si te atascas, usa <strong>Mostrar solución</strong>.</p>

    <div class="crossword-wrap">
      <!-- grid -->
      <div>
        <div id="cwGrid" class="cw-grid"></div>

        <div class="cw-actions">
          <button id="cwCheck" class="btn">Comprobar crucigrama</button>
          <button id="cwShow" class="btn ghost">Mostrar solución</button>
          <button id="cwReset" class="btn ghost">Reiniciar crucigrama</button>
        </div>
      </div>

      <!-- clues -->
      <div class="clues">
        <h4>Palabras a encontrar</h4>
        <ol>
          <li><strong>AHORRO</strong> — Reserva de dinero para emergencias o proyectos.</li>
          <li><strong>PRESUPUESTO</strong> — Plan de ingresos y gastos.</li>
          <li><strong>INVERSION</strong> — Destinar recursos para obtener rendimiento.</li>
          <li><strong>CREDITO</strong> — Dinero prestado con condiciones.</li>
          <li><strong>DIVERSIFICAR</strong> — No depender de una sola fuente de ingreso.</li>
          <li><strong>FONDO</strong> — Reserva para emergencias (fondo de emergencia).</li>
        </ol>
      </div>
    </div>

  </section>

  <!-- RECOMENDACIONES -->
  <section id="recomendaciones" class="card">
    <h2>Recomendaciones prácticas</h2>
    <ul>
      <li>Organiza sesiones presenciales de práctica con la página en la sala de informática de la institución.</li>
      <li>Fomenta el ahorro familiar con metas pequeñas y visibles (ej.: ahorro para útiles escolares).</li>
      <li>Registra ingresos y gastos: una libreta o hoja de cálculo es suficiente.</li>
      <li>Inicia proyectos productivos con capital semilla pequeño y controlado.</li>
      <li>Comparte lo aprendido en talleres comunitarios: el conocimiento en grupo multiplica el impacto.</li>
    </ul>
  </section>

</main>

<footer>
  <div style="max-width:880px;margin:0 auto">
    <p style="margin:0 0 6px 0"><strong>Esmeraldas del Saber Financiero</strong> — Proyecto SENA / Institución Educativa Santa Bárbara · Coscuez, San Pablo de Borbur (Boyacá)</p>
    <p style="margin:0;color:var(--muted)">Si quieres que incluya un logo institucional o tus fotos locales (subidas por ti), dímelo y actualizo el paquete.</p>
  </div>
</footer>

<script>
/* ========== Scroll reveal ========== */
const cards = document.querySelectorAll('.card');
const observer = new IntersectionObserver(entries=>{
  entries.forEach(e=>{ if(e.isIntersecting) e.target.classList.add('visible') });
},{threshold:0.12});
cards.forEach(c=>observer.observe(c));

/* ========== Accordion ========== */
document.querySelectorAll('.acc-head').forEach(head=>{
  head.addEventListener('click', ()=>{
    const id = head.getAttribute('data-target');
    const body = document.getElementById(id);
    const open = body.classList.contains('open');
    document.querySelectorAll('.acc-body').forEach(b=>{ b.classList.remove('open'); b.setAttribute('aria-hidden','true'); b.previousElementSibling.setAttribute('aria-expanded','false') });
    if(!open){ body.classList.add('open'); body.setAttribute('aria-hidden','false'); head.setAttribute('aria-expanded','true') }
  });
});

/* ========== BOOK DOWNLOAD (generate local guide files) ========== */
function makeGuideContent(title, author){
  return `Guía: ${title}
Autor: ${author}

Resumen breve:
- Idea principal: (resumen corto del libro)
- 3 lecciones aplicables a jóvenes rurales:
  1) ...
  2) ...
  3) ...

Sugerencias prácticas:
- Actividad 1: ...
- Actividad 2: ...
  
(Documento generado automáticamente desde "Esmeraldas del Saber Financiero")`;
}

document.querySelectorAll('.download-btn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const title = btn.getAttribute('data-title') || 'Guía';
    const author = btn.getAttribute('data-author') || 'Autor';
    const content = makeGuideContent(title, author);
    const blob = new Blob([content], {type: 'text/plain;charset=utf-8'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    // file name safe
    const fileName = `${title.replace(/[^a-z0-9_\- ]/gi,'').trim().replace(/\s+/g,'_')}_guia.txt`;
    a.download = fileName;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  });
});

/* preview buttons (muestra alerta con resumen breve) */
document.querySelectorAll('.book .download-row button[data-preview]').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const t = btn.getAttribute('data-preview') || 'Resumen';
    alert(t + "\\n\\nResumen breve: (Aquí iría un resumen rápido del libro).");
  });
});

/* ========== Quiz (options randomized) ========== */
const quizData = [
  { q:"¿Cuál es la principal razón para tener un presupuesto en Coscuez?", opts:["Planificar el uso de ingresos variables de la minería","Para pedir más préstamos","Para comparar precios de esmeraldas"], correct:0, explain:"El presupuesto ayuda a planificar cuando los ingresos son irregulares." },
  { q:"¿Qué se recomienda guardar en un fondo de emergencia?", opts:["Dinero para imprevistos (salud, accidentes, paros)","Dinero para vacaciones","Dinero para juegos"], correct:0, explain:"El fondo de emergencia cubre gastos inesperados y protege la estabilidad familiar." },
  { q:"¿Qué representa la diversificación para una familia minera?", opts:["Tener varias fuentes de ingreso (agricultura, comercio, minería)","Concentrar todo en la minería","Vender la casa"], correct:0, explain:"Diversificar reduce riesgos si cambia el precio o la producción minera." },
  { q:"¿Por qué evitar créditos informales?", opts:["Porque suelen tener condiciones y tasas perjudiciales","Porque son rápidos","Porque no requieren papeles"], correct:0, explain:"Los créditos informales suelen ser caros y riesgosos." },
  { q:"¿Qué práctica ayuda a mejorar el puntaje crediticio?", opts:["Pagar a tiempo las obligaciones y evitar mora","Solicitar muchos créditos","No usar cuentas bancarias"], correct:0, explain:"Pagar a tiempo demuestra responsabilidad y mejora el historial." },
  { q:"¿Qué porcentaje inicial se sugiere destinar al ahorro cuando los ingresos son variables?", opts:["10% - 20% de cada ingreso extra","80% de todos los ingresos","0% si se gana poco"], correct:0, explain:"Reservar un porcentaje pequeño y constante ayuda a construir un fondo." },
  { q:"¿Cuál es una inversión responsable para una comunidad rural?", opts:["Proyectos productivos locales con demanda comprobada","Comprar tecnología cara sin planeación","Invertir todo en un solo negocio riesgoso"], correct:0, explain:"Las inversiones pequeñas y planificadas son más sostenibles en contextos rurales." },
  { q:"¿Qué acción reduce el riesgo de gasto impulsivo?", opts:["Tener una lista y priorizar necesidades","Ir de compras sin plan","Pedir préstamos para compras"], correct:0, explain:"Priorizar evita decisiones impulsivas que afectan el presupuesto." },
  { q:"¿Cuál es la utilidad de registrar ingresos y gastos?", opts:["Conocer a dónde va el dinero y poder ajustar el presupuesto","Hacer cuentas solo por curiosidad","Para impresionar a otros"], correct:0, explain:"El registro permite tomar decisiones informadas sobre ahorro y gasto." },
  { q:"¿Qué debe buscar una persona antes de solicitar un crédito formal?", opts:["Tasas, plazos y capacidad de pago real","Que sea rápido y sin evaluación","Que sea del vecino"], correct:0, explain:"Evaluar condiciones evita sobreendeudamiento y problemas futuros." }
];

const quizContainer = document.getElementById('quizContainer');

function shuffleArray(a){
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function renderQuiz(){
  quizContainer.innerHTML = '';
  // For each question, we will shuffle options but keep track of which becomes correct.
  quizData.forEach((it, i)=>{
    // create copy of options with original index
    const opts = it.opts.map((o, idx)=>({text:o, idx}));
    shuffleArray(opts);
    // find new index of correct
    const newCorrect = opts.findIndex(o=>o.idx === it.correct);
    const div = document.createElement('div');
    div.className='q-block';
    div.dataset.correctIndex = newCorrect; // store which radio value is correct
    // Build options html
    const optsHtml = opts.map((o,j)=>`<label><input type="radio" name="q${i}" value="${j}"> ${o.text}</label>`).join('');
    div.innerHTML = `<p class="question">${i+1}. ${it.q}</p><div class="options">${optsHtml}</div><div class="hint" style="display:none;margin-top:8px;color:var(--muted)">${it.explain}</div>`;
    quizContainer.appendChild(div);
  });
}
renderQuiz();

document.getElementById('checkBtn').addEventListener('click', ()=>{
  let score=0;
  document.querySelectorAll('.q-block').forEach((qb,idx)=>{
    qb.classList.remove('correct','wrong');
    const sel = qb.querySelector('input[type=radio]:checked');
    const hint = qb.querySelector('.hint');
    hint.style.display='none';
    const correctIndex = Number(qb.dataset.correctIndex);
    if(sel){
      if(Number(sel.value) === correctIndex){ score++; qb.classList.add('correct') }
      else { qb.classList.add('wrong') }
      hint.style.display='block';
    } else {
      qb.classList.add('wrong');
      hint.style.display='block';
    }
  });
  const pct = Math.round((score/quizData.length)*100);
  const res = document.getElementById('result');
  res.style.display='block';
  let msg = `Obtuviste ${score}/${quizData.length} — ${pct}%`;
  if(pct === 100) msg += " 🎉 Excelente: manejas los conceptos clave.";
  else if(pct >= 70) msg += " 👍 Muy bien — repasa algunos puntos.";
  else if(pct >= 40) msg += " ✨ Va bien — vuelve a revisar las definiciones.";
  else msg += " 🔎 Recomendado: repasar y volver a intentar.";
  res.innerHTML = msg;
  res.scrollIntoView({behavior:'smooth', block:'center'});
});

document.getElementById('resetBtn').addEventListener('click', ()=>{
  document.querySelectorAll('.q-block input[type=radio]').forEach(i=>i.checked=false);
  document.querySelectorAll('.q-block').forEach(q=>{ q.classList.remove('wrong','correct'); q.querySelector('.hint').style.display='none';});
  const res = document.getElementById('result'); res.style.display='none'; res.innerHTML='';
  // re-render to reshuffle options
  renderQuiz();
  document.getElementById('quiz').scrollIntoView({behavior:'smooth'});
});

/* ========== CRUCIGRAMA (fácil, casillas con comprobación) ========== */
/*
 We kept the 12x12 concept but simplified by placing words in template.
 Template: letters are solutions; '_' or undefined = black cell.
*/
const cwConfig = {
  rows:12, cols:12,
  template: [
    "AHORRO_____",
    "___________",
    "PRESUPUESTO",
    "___________",
    "_INVERSION_",
    "___CREDITO_",
    "___________",
    "DIVERSIFICAR",
    "___________",
    "_______FOND",
    "__________O",
    "____________"
  ]
};

const cwGridEl = document.getElementById('cwGrid');

function buildCW(){
  cwGridEl.innerHTML = '';
  cwGridEl.style.gridTemplateColumns = `repeat(${cwConfig.cols}, 36px)`;
  cwConfig.template.forEach((rowStr, r)=>{
    for(let c=0;c<cwConfig.cols;c++){
      const ch = rowStr[c] || '_';
      const cell = document.createElement('div');
      cell.className='cw-cell';
      if(ch === '_' || ch === undefined){
        cell.classList.add('black');
      } else {
        const inp = document.createElement('input');
        inp.setAttribute('maxlength','1');
        inp.setAttribute('data-solution', ch.toUpperCase());
        inp.setAttribute('aria-label', `casilla ${r+1}-${c+1}`);
        inp.addEventListener('input', ()=>{ inp.value = inp.value.toUpperCase().replace(/[^A-ZÑÁÉÍÓÚ]/g,'').slice(0,1); });
        cell.appendChild(inp);
      }
      cwGridEl.appendChild(cell);
    }
  });
}
buildCW();

function checkCW(showCorrect=false){
  const cells = cwGridEl.querySelectorAll('.cw-cell');
  let total=0, correct=0;
  cells.forEach(cell=>{
    const inp = cell.querySelector('input');
    if(inp){
      total++;
      const sol = inp.getAttribute('data-solution');
      const val = (inp.value || '').toUpperCase();
      if(val === sol){ correct++; cell.style.background='rgba(0,200,107,0.06)'; cell.style.border='1px solid rgba(0,200,107,0.16)' }
      else {
        cell.style.background='rgba(255,80,80,0.03)';
        cell.style.border='1px solid rgba(255,80,80,0.12)';
        if(showCorrect) inp.value = sol;
      }
    }
  });
  return {total,correct};
}

document.getElementById('cwCheck').addEventListener('click', ()=>{
  const res = checkCW(false);
  const msg = `Casillas correctas: ${res.correct}/${res.total}`;
  alert(msg);
});
document.getElementById('cwShow').addEventListener('click', ()=>{
  checkCW(true);
});
document.getElementById('cwReset').addEventListener('click', ()=>{
  cwGridEl.querySelectorAll('input').forEach(i=>i.value='');
  cwGridEl.querySelectorAll('.cw-cell').forEach(cell=>{ cell.style.background='rgba(255,255,255,0.02)'; cell.style.border='1px solid rgba(255,255,255,0.03)'; });
});

/* Preload: reveal first acc */
window.addEventListener('load', ()=>{
  document.querySelectorAll('.card').forEach(c=>c.classList.add('visible'));
  const first = document.getElementById('acc1');
  if(first){ first.classList.add('open'); first.setAttribute('aria-hidden','false'); first.previousElementSibling.setAttribute('aria-expanded','true'); }
});
</script>
</body>
</html>
